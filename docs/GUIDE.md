# Whisper Voice Auth Microservice - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [API Endpoints](#api-endpoints)
- [–ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏](#–≥–∏–±—Ä–∏–¥–Ω–æ–µ-—Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ-—Ä–µ—á–∏)
- [–ì–æ–ª–æ—Å–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è](#–≥–æ–ª–æ—Å–æ–≤–∞—è-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
- [CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å](#cli-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å)
- [–†–∞–±–æ—Ç–∞ —Å Docker](#—Ä–∞–±–æ—Ç–∞-—Å-docker)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–æ—Ç–ª–∞–¥–∫–∞)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

Whisper Voice Auth Microservice - —ç—Ç–æ –≥–∏–±—Ä–∏–¥–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≥–æ–ª–æ—Å–æ–≤–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

### üöÄ –ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ STT
- **–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å**: OpenAI Whisper API (gpt-4o-audio)
- **–†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å**: –õ–æ–∫–∞–ª—å–Ω—ã–π Whisper (whisper-large-v3)
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback**: –ü—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏–ª–∏ –æ—à–∏–±–∫–∞—Ö OpenAI API

### üîê –ì–æ–ª–æ—Å–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤—ã—Ö –æ—Ç–ø–µ—á–∞—Ç–∫–æ–≤
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ –≥–æ–ª–æ—Å—É
- –ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –±–∏–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### üéØ –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
- Semantic validation —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 99+ —è–∑—ã–∫–æ–≤
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏

### ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ—Ä–µ–∑ OpenAI API (~2-5 —Å–µ–∫)
- –ù–∞–¥–µ–∂–Ω—ã–π fallback –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤
- Concurrent processing –¥–æ 10 –∑–∞–ø—Ä–æ—Å–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd whisper

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞
./setup.sh

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞
make run
```

### –î–µ—Ç–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

#### 1. –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.12+
- FFmpeg (–¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ)
- 4GB+ RAM (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ whisper)
- CUDA (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è GPU —É—Å–∫–æ—Ä–µ–Ω–∏—è)

#### 2. –°–æ–∑–¥–∞–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

#### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.sample .env

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
python generate_key.py

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
mkdir -p storage/audio storage/voiceprints
```

#### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OpenAI API (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
# –î–æ–±–∞–≤—å—Ç–µ –≤ .env —Ñ–∞–π–ª
echo "OPENAI_API_KEY=your_openai_api_key_here" >> .env
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Environment Variables

#### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```bash
# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
WHISPER_API_KEY=your_secure_api_key
ENCRYPTION_KEY=your_encryption_key

# OpenAI Configuration (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
OPENAI_API_KEY=your_openai_api_key
```

#### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```bash
# –°–µ—Ä–≤–∏—Å STT
WHISPER_PRIMARY_SERVICE=openai          # "openai" –∏–ª–∏ "local"
WHISPER_FALLBACK_TO_LOCAL=true          # –í–∫–ª—é—á–∏—Ç—å fallback

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
WHISPER_MAX_WORKERS=4                   # Concurrent workers
WHISPER_CHUNK_SIZE_MB=10               # –†–∞–∑–º–µ—Ä chunks

# Semantic validation
WHISPER_HYBRID_STT_USE_SEMANTIC_VALIDATION=false
WHISPER_HYBRID_STT_SEMANTIC_THRESHOLD=0.8
```

### Config.yaml
```yaml
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
primary_service: "openai"
fallback_to_local: true

# OpenAI Whisper API
openai:
  api_key: "${OPENAI_API_KEY}"
  model: "whisper-1"
  max_file_size_mb: 25
  timeout_seconds: 30
  max_retries: 3

# –õ–æ–∫–∞–ª—å–Ω—ã–π Whisper
local_whisper:
  model: "large-v3"
  device: "auto"
  compute_type: "float16"

# –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
semantic:
  model: "sentence-transformers/all-MiniLM-L6-v2"
  threshold: 0.8
  enabled: false
```

## API Endpoints

### –ë–∞–∑–æ–≤—ã–π URL
```
http://localhost:8000
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫:
```
X-API-Key: your_api_key_here
```

### 1. –ì–∏–±—Ä–∏–¥–Ω–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è - `/api/v1/hybrid/stt`

–û—Å–Ω–æ–≤–Ω–æ–π endpoint –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º fallback.

#### –ú–µ—Ç–æ–¥: POST

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `audio_file` (file, required) - –ê—É–¥–∏–æ—Ñ–∞–π–ª (WAV, MP3, OGG, FLAC, M4A)
- `language` (string, optional) - –ö–æ–¥ —è–∑—ã–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "ru", "en")
- `prompt` (string, optional) - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞
- `verify_speaker` (boolean, optional) - –í–∫–ª—é—á–∏—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –≥–æ–≤–æ—Ä—è—â–µ–≥–æ
- `user_id` (string, optional) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `use_semantics` (boolean, optional) - –í–∫–ª—é—á–∏—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X POST "http://localhost:8000/api/v1/hybrid/stt" \
  -H "X-API-Key: your_api_key" \
  -F "audio_file=@audio.wav" \
  -F "language=ru" \
  -F "prompt=–≠—Ç–æ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è" \
  -F "verify_speaker=true" \
  -F "user_id=user123"
```

#### –û—Ç–≤–µ—Ç:
```json
{
  "source": "openai",
  "text": "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, —É –º–µ–Ω—è –±–æ–ª–∏—Ç –≥–æ–ª–æ–≤–∞",
  "metadata": {
    "confidence": 0.95,
    "language": "ru",
    "duration": 3.2,
    "speaker_match": 0.87,
    "fallback_used": false,
    "semantic_diff": null,
    "service_used": "openai"
  }
}
```

### 2. –ü–µ—Ä–µ–≤–æ–¥ –∞—É–¥–∏–æ - `/api/v1/hybrid/translate`

–¢—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫.

#### –ú–µ—Ç–æ–¥: POST

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `audio_file` (file, required) - –ê—É–¥–∏–æ—Ñ–∞–π–ª
- `prompt` (string, optional) - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```bash
curl -X POST "http://localhost:8000/api/v1/hybrid/translate" \
  -H "X-API-Key: your_api_key" \
  -F "audio_file=@audio_ru.wav" \
  -F "prompt=Medical consultation"
```

#### –û—Ç–≤–µ—Ç:
```json
{
  "source": "openai",
  "text": "Hello, I have a headache",
  "original_language": "ru",
  "metadata": {
    "confidence": 0.92,
    "duration": 3.2,
    "fallback_used": false
  }
}
```

### 3. –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–æ–ª–æ—Å–∞ - `/api/v1/voice/verify`

–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –≥–æ–≤–æ—Ä—è—â–µ–≥–æ.

#### –ú–µ—Ç–æ–¥: POST

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `audio_file` (file, required) - –ê—É–¥–∏–æ—Ñ–∞–π–ª
- `user_id` (string, required) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `language` (string, optional) - –ö–æ–¥ —è–∑—ã–∫–∞

#### –û—Ç–≤–µ—Ç:
```json
{
  "text": "–ü—Ä–∏–≤–µ—Ç, —ç—Ç–æ —è",
  "speaker_verified": true,
  "confidence": 0.94,
  "speaker_similarity": 0.89,
  "metadata": {
    "language": "ru",
    "duration": 2.1
  }
}
```

### 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –æ—Ç–ø–µ—á–∞—Ç–∫–∞ - `/api/v1/voice/register`

#### –ú–µ—Ç–æ–¥: POST

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `audio_file` (file, required) - –ê—É–¥–∏–æ—Ñ–∞–π–ª –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- `user_id` (string, required) - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 5. Health Check - `/health`

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–æ–≤.

#### –ú–µ—Ç–æ–¥: GET

#### –û—Ç–≤–µ—Ç:
```json
{
  "status": "healthy",
  "timestamp": "2025-06-16T12:00:00Z",
  "components": {
    "api": "ready",
    "local_whisper": "ready",
    "openai": "ready",
    "hybrid_stt": "ready"
  },
  "services": {
    "primary_stt": "openai",
    "fallback_available": true,
    "voice_auth": "enabled"
  }
}
```

## –ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏

### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞**
   - –§–∞–π–ª—ã ‚â§ 25MB –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ OpenAI API
   - –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ

2. **–ü–æ–ø—ã—Ç–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (OpenAI)**
   - –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (~2-5 —Å–µ–∫)
   - –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
   - –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞

3. **Fallback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö**
   - –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å OpenAI API
   - –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤
   - –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

4. **–õ–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞**
   - Whisper large-v3 –º–æ–¥–µ–ª—å
   - –ü–æ–ª–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏

#### –¢–æ–ª—å–∫–æ OpenAI API
```bash
export WHISPER_PRIMARY_SERVICE=openai
export WHISPER_FALLBACK_TO_LOCAL=false
```

#### –¢–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω—ã–π Whisper
```bash
export WHISPER_PRIMARY_SERVICE=local
```

#### –ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
```bash
export WHISPER_PRIMARY_SERVICE=openai
export WHISPER_FALLBACK_TO_LOCAL=true
```

### –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞–∑–Ω—ã—Ö STT —Å–µ—Ä–≤–∏—Å–æ–≤:

```bash
export WHISPER_HYBRID_STT_USE_SEMANTIC_VALIDATION=true
export WHISPER_HYBRID_STT_SEMANTIC_THRESHOLD=0.8
```

–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–∞:
1. –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
2. –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç fallback —Å–µ—Ä–≤–∏—Å–∞
3. –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç semantic similarity
4. –ü—Ä–∏ –Ω–∏–∑–∫–æ–π —Å—Ö–æ–∂–µ—Å—Ç–∏ –ø–æ–º–µ—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π

## –ì–æ–ª–æ—Å–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–æ–≤—ã—Ö –æ–±—Ä–∞–∑—Ü–æ–≤

–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –æ—Ç–ø–µ—á–∞—Ç–∫–∞ –Ω—É–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–∑—Ü—ã –≥–æ–ª–æ—Å–∞:

```bash
# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∑–∞–ø–∏—Å—å
python record_samples.py --samples 3 --duration 10

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã
python record_samples.py --from-files sample1.wav sample2.wav sample3.wav
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
# –ß–µ—Ä–µ–∑ API
curl -X POST "http://localhost:8000/api/v1/voice/register" \
  -H "X-API-Key: your_api_key" \
  -F "audio_file=@voice_sample.wav" \
  -F "user_id=user123"

# –ß–µ—Ä–µ–∑ CLI
python voice_auth.py register --user-id user123 --audio voice_sample.wav
```

### –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–æ–ª–æ—Å–∞

```bash
# –í —Å–æ—Å—Ç–∞–≤–µ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
curl -X POST "http://localhost:8000/api/v1/hybrid/stt" \
  -H "X-API-Key: your_api_key" \
  -F "audio_file=@test_audio.wav" \
  -F "verify_speaker=true" \
  -F "user_id=user123"

# –¢–æ–ª—å–∫–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
curl -X POST "http://localhost:8000/api/v1/voice/verify" \
  -H "X-API-Key: your_api_key" \
  -F "audio_file=@test_audio.wav" \
  -F "user_id=user123"
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≥–æ–ª–æ—Å–æ–≤—ã—Ö –æ—Ç–ø–µ—á–∞—Ç–∫–æ–≤

- **–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ –æ—Ç–ø–µ—á–∞—Ç–∫–∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω—ã AES-256
- **–•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ö–µ—à–∏—Ä—É—é—Ç—Å—è
- **–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ**: –î–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç –≤–∞—à —Å–µ—Ä–≤–µ—Ä
- **–£–¥–∞–ª–µ–Ω–∏–µ**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–ø–µ—á–∞—Ç–∫–æ–≤

## CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### Hybrid STT CLI

–ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏:

```bash
# –ë–∞–∑–æ–≤–∞—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è
python hybrid_stt.py --file audio.wav

# –° –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
python hybrid_stt.py \
  --file audio.wav \
  --verify_speaker \
  --use_semantics \
  --semantic_threshold 0.8

# –°–ø—Ä–∞–≤–∫–∞
python hybrid_stt.py --help
```

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã CLI:
- `--file` - –ü—É—Ç—å –∫ –∞—É–¥–∏–æ—Ñ–∞–π–ª—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- `--verify_speaker` - –í–∫–ª—é—á–∏—Ç—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—é –≥–æ–≤–æ—Ä—è—â–µ–≥–æ
- `--use_semantics` - –í–∫–ª—é—á–∏—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
- `--semantic_threshold` - –ü–æ—Ä–æ–≥ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π —Å—Ö–æ–∂–µ—Å—Ç–∏ (0.0-1.0)

#### –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
```
Processing audio file: audio.wav
Options: verify_speaker=True, use_semantics=True

=== Hybrid STT Results ===
Source: openai
Text: –ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?

Metadata:
  confidence: 0.95
  duration: 2.3
  language: ru
  fallback_used: False
  speaker_match: 0.87
  semantic_diff: 0.05

JSON Response:
{
  "source": "openai",
  "text": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?",
  "metadata": {
    "confidence": 0.95,
    "speaker_match": 0.87,
    "duration": 2.3,
    "language": "ru",
    "fallback_used": false,
    "semantic_diff": 0.05
  }
}
```

### Batch Processing

```bash
# –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
for file in *.wav; do
  python hybrid_stt.py --file "$file" >> results.txt
done

# –ò–ª–∏ —Å –ø–æ–º–æ—â—å—é —Å–∫—Ä–∏–ø—Ç–∞
python batch_process.py --input-dir ./audio_files --output results.json
```

## –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –æ—Ç–ø–µ—á–∞—Ç–∫–∞

–ü–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –æ–±—Ä–∞–∑—Ü–æ–≤ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤–∞—à –≥–æ–ª–æ—Å–æ–≤–æ–π –æ—Ç–ø–µ—á–∞—Ç–æ–∫:

```bash
./test_client.py register samples/sample_1.wav samples/sample_2.wav samples/sample_3.wav
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–º

–ó–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é:

```bash
# –ó–∞–ø–∏—Å—å —Ç–µ—Å—Ç–æ–≤–æ–π –∫–æ–º–∞–Ω–¥—ã
./record_samples.py --samples 1 --duration 5 --output-dir test_commands

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
./test_client.py verify test_commands/sample_1.wav
```

## –ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—é —Ä–µ—á–∏, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω—É—é –º–æ–¥–µ–ª—å Whisper, —Ç–∞–∫ –∏ –≤–Ω–µ—à–Ω–∏–π API –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–õ–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (–ø–µ—Ä–≤–∏—á–Ω–∞—è):**
   - –ê—É–¥–∏–æ—Ñ–∞–π–ª —Å–Ω–∞—á–∞–ª–∞ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é Whisper
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (`confidence`)
   - –ï—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≥–æ–ª–æ—Å–∞, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –æ—Ç–ø–µ—á–∞—Ç–∫—É (`speaker_match`)

2. **–í–Ω–µ—à–Ω—è—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ (—Ä–µ–∑–µ—Ä–≤–Ω–∞—è):**
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–ª—É—á–∞—è—Ö, –∫–æ–≥–¥–∞:
     - –õ–æ–∫–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–¥–∞–ª–∞ –æ—à–∏–±–∫—É
     - –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è (`confidence`) –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
     - –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≥–æ–ª–æ—Å—É (`speaker_match`) –Ω–∏–∂–µ –ø–æ—Ä–æ–≥–æ–≤–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
     - –Ø–∑—ã–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é

3. **–í—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
   - –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è —Å–º—ã—Å–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –Ω–∞–∏–ª—É—á—à–∏–º–∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è–º–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ CLI

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CLI-—Å–∫—Ä–∏–ø—Ç:

```bash
./hybrid_stt.py --file ./samples/command.wav --verify_speaker --use_semantics --semantic_threshold 0.8
```

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `--file` - –ø—É—Ç—å –∫ –∞—É–¥–∏–æ—Ñ–∞–π–ª—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π)
- `--verify_speaker` - –≤–∫–ª—é—á–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≥–æ–ª–æ—Å–∞
- `--use_semantics` - –≤–∫–ª—é—á–∏—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- `--semantic_threshold` - –ø–æ—Ä–æ–≥ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –±–ª–∏–∑–æ—Å—Ç–∏ (0.0-1.0)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `config.yaml` –≤ —Å–µ–∫—Ü–∏–∏ `hybrid_stt`:

```yaml
hybrid_stt:
  whisper_url: "http://localhost:8000"  # URL –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
  remote_api_url: "https://api.example.com/stt"  # URL –≤–Ω–µ—à–Ω–µ–≥–æ API
  min_confidence: 0.85  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏
  min_speaker_match: 0.90  # –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –≥–æ–ª–æ—Å–∞
  timeout_local: 5  # –¢–∞–π–º–∞—É—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
  use_semantic_validation: false  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
  semantic_model: "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2"  # –ú–æ–¥–µ–ª—å –¥–ª—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
  semantic_threshold: 0.75  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –±–ª–∏–∑–æ—Å—Ç—å –¥–ª—è –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
```

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```
WHISPER_HYBRID_STT_WHISPER_URL=http://localhost:8000
WHISPER_HYBRID_STT_REMOTE_API_URL=https://api.example.com/stt
WHISPER_HYBRID_STT_MIN_CONFIDENCE=0.85
WHISPER_HYBRID_STT_MIN_SPEAKER_MATCH=0.90
WHISPER_HYBRID_STT_TIMEOUT_LOCAL=5
WHISPER_HYBRID_STT_USE_SEMANTIC_VALIDATION=true
WHISPER_HYBRID_STT_SEMANTIC_MODEL=sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2
WHISPER_HYBRID_STT_SEMANTIC_THRESHOLD=0.75
```

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞

```json
{
  "source": "local",  // –∏–ª–∏ "remote" –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞
  "text": "—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç",
  "metadata": {
    "confidence": 0.93,  // —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è
    "speaker_match": 0.97,  // —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≥–æ–ª–æ—Å–æ–≤–æ–º—É –æ—Ç–ø–µ—á–∞—Ç–∫—É (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
    "duration": 7.5,  // –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–¥–∏–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
    "language": "ru",  // –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π —è–∑—ã–∫
    "fallback_used": false,  // –±—ã–ª –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –º–µ—Ç–æ–¥
    "semantic_diff": 0.12  // —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
  }
}
```

### –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

–ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–π —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å `sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2` –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –±–ª–∏–∑–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –∏ –≤–Ω–µ—à–Ω–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–±—Ä–∞—Ç—å –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–∞–∂–µ –ø—Ä–∏ –±–ª–∏–∑–∫–∏—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª—è—Ö —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è.

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install sentence-transformers
```

## API Endpoints

### GET `/health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞.

### POST `/api/v1/voice/verify`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ–ª–æ—Å–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST \
  http://localhost:8000/api/v1/voice/verify \
  -H "X-API-Key: your-api-key" \
  -F "audio_file=@./command.wav"
```

### POST `/api/v1/voice/register`
–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –æ—Ç–ø–µ—á–∞—Ç–∫–∞.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST \
  http://localhost:8000/api/v1/voice/register \
  -H "X-API-Key: your-api-key" \
  -F "audio_files=@./sample1.wav" \
  -F "audio_files=@./sample2.wav" \
  -F "audio_files=@./sample3.wav"
```

### POST `/api/v1/hybrid/stt`
–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–∏–±—Ä–∏–¥–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ (–ª–æ–∫–∞–ª—å–Ω–æ–µ + –≤–Ω–µ—à–Ω–µ–µ API).

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl -X POST \
  http://localhost:8000/api/v1/hybrid/stt \
  -H "X-API-Key: your-api-key" \
  -F "audio_file=@./command.wav" \
  -F "verify_speaker=false" \
  -F "use_semantics=true" \
  -F "semantic_threshold=0.8" \
  -F "return_debug=true"
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `verify_speaker` - –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ª–∏ –≥–æ–ª–æ—Å –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —ç—Ç–∞–ª–æ–Ω–Ω–æ–º—É (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false)
- `use_semantics` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false)
- `semantic_threshold` - –ø–æ—Ä–æ–≥ —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–π –±–ª–∏–∑–æ—Å—Ç–∏ (0.0-1.0)
- `return_debug` - –≤–∫–ª—é—á–∞—Ç—å –ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é false)

## –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —è–∑—ã–∫–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏

–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —è–∑—ã–∫–æ–≤–æ–π –º–æ–¥–µ–ª—å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å URL API –∏ –∫–ª—é—á –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```yaml
# config.yaml
llm:
  api_url: "http://your-llm-service/api/v1/process"
  api_key: "your-llm-api-key"
  timeout: 30
```

–ò–ª–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```
WHISPER_LLM_API_URL=http://your-llm-service/api/v1/process
WHISPER_LLM_API_KEY=your-llm-api-key
```

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–∏—Å–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `config.yaml` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------------------|----------|
| API –∫–ª—é—á | WHISPER_API_KEY | –ö–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ API |
| –ü–æ—Ä–æ–≥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ | WHISPER_AUTH_SPEAKER_VERIFICATION_THRESHOLD | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Å—Ö–æ–∂–µ—Å—Ç–∏ –≥–æ–ª–æ—Å–∞ (0.0-1.0) |
| –ú–æ–¥–µ–ª—å Whisper | WHISPER_TRANSCRIPTION_WHISPER_MODEL | –†–∞–∑–º–µ—Ä –º–æ–¥–µ–ª–∏ (tiny, base, small, medium, large) |
| –Ø–∑—ã–∫ | WHISPER_TRANSCRIPTION_LANGUAGE | –ö–æ–¥ —è–∑—ã–∫–∞ –∏–ª–∏ null –¥–ª—è –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è |

## –†–∞–±–æ—Ç–∞ —Å Docker

### –ó–∞–ø—É—Å–∫ —Å Docker Compose
```bash
docker compose up -d
```

### –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
```bash
docker build -t whisper .
```

### –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
```bash
docker run -p 8000:8000 -v $(pwd)/storage:/app/storage whisper
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ–º —Ä–µ—á–∏

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥–æ–ª–æ—Å–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
./test_whisper.py your_audio_file.wav --model base
```

### –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–±—Ä–∞–∑—Ü—ã –≥–æ–ª–æ—Å–∞ –∑–∞–ø–∏—Å–∞–Ω—ã –≤ —Ç–∏—Ö–æ–º –ø–æ–º–µ—â–µ–Ω–∏–∏
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –¥–ª–∏–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—Ü—ã (10+ —Å–µ–∫—É–Ω–¥)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ—Ä–æ–≥ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–±–ª–µ–º—ã —Å FFmpeg

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ FFmpeg —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–∏—Å—Ç–µ–º–µ:
```bash
ffmpeg -version
```
